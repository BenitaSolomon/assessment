{"id":"../smoke-node/bucket/reader.ts","dependencies":[{"name":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\tsconfig.json","includedInParent":true,"mtime":1582445133494},{"name":"C:\\Users\\Administrator\\Desktop\\smoke\\package.json","includedInParent":true,"mtime":1582444621053},{"name":"../async/index","loc":{"line":30,"column":24},"parent":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\bucket\\reader.ts","resolved":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\async\\index.ts"},{"name":"../buffer/index","loc":{"line":31,"column":24},"parent":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\bucket\\reader.ts","resolved":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\buffer\\index.ts"},{"name":"./errors","loc":{"line":32,"column":25},"parent":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\bucket\\reader.ts","resolved":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\bucket\\errors.ts"},{"name":"./constants","loc":{"line":33,"column":28},"parent":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\bucket\\reader.ts","resolved":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\bucket\\constants.ts"}],"generated":{"js":"\"use strict\";\n/*--------------------------------------------------------------------------\r\n\r\nsmoke-node\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2020 Haydn Paterson (sinclair) <haydn.developer@gmail.com>\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n\r\n---------------------------------------------------------------------------*/\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst index_1 = require(\"../async/index\");\n\nconst index_2 = require(\"../buffer/index\");\n\nconst errors_1 = require(\"./errors\");\n\nconst constants_1 = require(\"./constants\");\n/**\r\n * Reader\r\n *\r\n * Internal reader type. Used to read buffer streams from IDB storage. This type\r\n * is used by the buckets readable() method to construct a Readable<Buffer> type\r\n * for streaming files.\r\n */\n\n\nclass Reader {\n  /** Creates a new reader with the given options. */\n  constructor(options) {\n    this.database = options.database;\n    this.semaphore = options.semaphore;\n    this.key = options.key;\n    this.barrier = new index_1.Barrier();\n    this.blob = new Blob([]);\n    this.chunkSize = 65536;\n    this.start = options.start || 0;\n    this.end = options.end || Infinity;\n    this.offset = this.start;\n  }\n  /** Prepares this reader for reading. */\n\n\n  async prepare() {\n    return this.semaphore.run(async () => {\n      if (!(await this.database.exists(constants_1.FileStore, this.key))) {\n        throw new errors_1.FileNotFoundError(this.key);\n      }\n\n      const file = await this.database.get(constants_1.FileStore, this.key);\n      const blobs = file.blobs.map(async link => {\n        const blob = await this.database.get(constants_1.BlobStore, link);\n        if (!blob) throw new errors_1.BlobNotFound(this.key, link);\n        return blob.blob;\n      });\n      this.blob = new Blob((await Promise.all(blobs)));\n      return this.barrier.resume();\n    });\n  }\n  /** Reads bytes from the underlying source. */\n\n\n  read() {\n    return this.execute(async () => {\n      let start = this.offset;\n      let end = start + this.chunkSize;\n\n      if (start >= this.end) {\n        start = this.end;\n      }\n\n      if (end >= this.end) {\n        end = this.end;\n      }\n\n      const buffer = await this.readBuffer(start, end);\n      this.offset += this.chunkSize;\n      return buffer;\n    });\n  }\n\n  readBuffer(start, end) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.addEventListener('progress', event => {});\n      reader.addEventListener('loadend', event => resolve(index_2.Buffer.from(event.target.result)));\n      reader.addEventListener('error', event => reject(event));\n      reader.readAsArrayBuffer(this.blob.slice(start, end));\n    });\n  }\n\n  execute(func) {\n    return this.barrier.run(() => func());\n  }\n\n}\n\nexports.Reader = Reader;"},"sourceMaps":{"js":{"mappings":[{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":2,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":34,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":34,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":34,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":34,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":34,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":34,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":34,"column":40}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":34,"column":41}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":36,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":36,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":36,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":36,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":36,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":36,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":36,"column":41}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":36,"column":42}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":38,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":38,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":38,"column":14}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":38,"column":17}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":38,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":38,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":38,"column":35}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":38,"column":36}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":40,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":40,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":40,"column":17}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":40,"column":20}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":40,"column":27}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":40,"column":28}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":40,"column":41}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":40,"column":42}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":49,"column":0},"generated":{"line":41,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":0},"generated":{"line":50,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":13},"generated":{"line":50,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":0},"generated":{"line":50,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":19},"generated":{"line":50,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":68,"column":2},"generated":{"line":51,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":69,"column":2},"generated":{"line":52,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":69,"column":2},"generated":{"line":52,"column":2}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":69,"column":2},"generated":{"line":52,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":69,"column":14},"generated":{"line":52,"column":14}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":69,"column":2},"generated":{"line":52,"column":21}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":69,"column":36},"generated":{"line":52,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":70,"column":4},"generated":{"line":53,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":70,"column":9},"generated":{"line":53,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":70,"column":4},"generated":{"line":53,"column":17}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":70,"column":20},"generated":{"line":53,"column":20}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":70,"column":27},"generated":{"line":53,"column":27}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":70,"column":28},"generated":{"line":53,"column":28}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":70,"column":4},"generated":{"line":53,"column":36}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":71,"column":4},"generated":{"line":54,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":71,"column":9},"generated":{"line":54,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":71,"column":4},"generated":{"line":54,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":71,"column":21},"generated":{"line":54,"column":21}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":71,"column":28},"generated":{"line":54,"column":28}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":71,"column":29},"generated":{"line":54,"column":29}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":71,"column":4},"generated":{"line":54,"column":38}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":72,"column":4},"generated":{"line":55,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":72,"column":9},"generated":{"line":55,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":72,"column":4},"generated":{"line":55,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":72,"column":15},"generated":{"line":55,"column":15}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":72,"column":22},"generated":{"line":55,"column":22}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":72,"column":23},"generated":{"line":55,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":72,"column":4},"generated":{"line":55,"column":26}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":73,"column":4},"generated":{"line":56,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":73,"column":9},"generated":{"line":56,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":73,"column":4},"generated":{"line":56,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":73,"column":19},"generated":{"line":56,"column":19}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":73,"column":23},"generated":{"line":56,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":73,"column":23},"generated":{"line":56,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":73,"column":23},"generated":{"line":56,"column":31}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":73,"column":19},"generated":{"line":56,"column":38}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":73,"column":4},"generated":{"line":56,"column":40}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":74,"column":4},"generated":{"line":57,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":74,"column":9},"generated":{"line":57,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":74,"column":4},"generated":{"line":57,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":74,"column":16},"generated":{"line":57,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":74,"column":20},"generated":{"line":57,"column":20}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":74,"column":16},"generated":{"line":57,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":74,"column":25},"generated":{"line":57,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":74,"column":16},"generated":{"line":57,"column":27}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":74,"column":4},"generated":{"line":57,"column":28}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":75,"column":4},"generated":{"line":58,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":75,"column":9},"generated":{"line":58,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":75,"column":4},"generated":{"line":58,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":75,"column":21},"generated":{"line":58,"column":21}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":75,"column":4},"generated":{"line":58,"column":26}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":76,"column":4},"generated":{"line":59,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":76,"column":9},"generated":{"line":59,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":76,"column":4},"generated":{"line":59,"column":14}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":76,"column":17},"generated":{"line":59,"column":17}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":76,"column":24},"generated":{"line":59,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":76,"column":25},"generated":{"line":59,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":76,"column":17},"generated":{"line":59,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":76,"column":34},"generated":{"line":59,"column":34}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":76,"column":4},"generated":{"line":59,"column":35}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":77,"column":4},"generated":{"line":60,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":77,"column":9},"generated":{"line":60,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":77,"column":4},"generated":{"line":60,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":77,"column":15},"generated":{"line":60,"column":15}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":77,"column":22},"generated":{"line":60,"column":22}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":77,"column":23},"generated":{"line":60,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":77,"column":15},"generated":{"line":60,"column":26}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":77,"column":30},"generated":{"line":60,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":77,"column":4},"generated":{"line":60,"column":38}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":78,"column":4},"generated":{"line":61,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":78,"column":9},"generated":{"line":61,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":78,"column":4},"generated":{"line":61,"column":15}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":78,"column":18},"generated":{"line":61,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":78,"column":23},"generated":{"line":61,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":78,"column":4},"generated":{"line":61,"column":28}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":79,"column":3},"generated":{"line":62,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":81,"column":2},"generated":{"line":63,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":82,"column":9},"generated":{"line":66,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":82,"column":15},"generated":{"line":66,"column":8}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":82,"column":9},"generated":{"line":66,"column":15}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":82,"column":22},"generated":{"line":66,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":4},"generated":{"line":67,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":11},"generated":{"line":67,"column":11}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":16},"generated":{"line":67,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":11},"generated":{"line":67,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":26},"generated":{"line":67,"column":26}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":11},"generated":{"line":67,"column":29}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":30},"generated":{"line":67,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":41},"generated":{"line":67,"column":42}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":6},"generated":{"line":68,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":10},"generated":{"line":68,"column":10}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":12},"generated":{"line":68,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":18},"generated":{"line":68,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":23},"generated":{"line":68,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":18},"generated":{"line":68,"column":31}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":32},"generated":{"line":68,"column":32}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":18},"generated":{"line":68,"column":38}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":39},"generated":{"line":68,"column":39}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":39},"generated":{"line":68,"column":50}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":39},"generated":{"line":68,"column":51}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":18},"generated":{"line":68,"column":60}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":50},"generated":{"line":68,"column":62}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":55},"generated":{"line":68,"column":67}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":18},"generated":{"line":68,"column":70}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":10},"generated":{"line":68,"column":71}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":6},"generated":{"line":68,"column":72}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":84,"column":62},"generated":{"line":68,"column":74}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":8},"generated":{"line":69,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":14},"generated":{"line":69,"column":14}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":18},"generated":{"line":69,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":18},"generated":{"line":69,"column":26}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":18},"generated":{"line":69,"column":27}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":14},"generated":{"line":69,"column":44}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":36},"generated":{"line":69,"column":45}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":41},"generated":{"line":69,"column":50}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":14},"generated":{"line":69,"column":53}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":85,"column":8},"generated":{"line":69,"column":54}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":86,"column":7},"generated":{"line":70,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":6},"generated":{"line":72,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":12},"generated":{"line":72,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":16},"generated":{"line":72,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":19},"generated":{"line":72,"column":19}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":25},"generated":{"line":72,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":30},"generated":{"line":72,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":25},"generated":{"line":72,"column":38}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":39},"generated":{"line":72,"column":39}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":25},"generated":{"line":72,"column":42}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":55},"generated":{"line":72,"column":43}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":55},"generated":{"line":72,"column":54}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":55},"generated":{"line":72,"column":55}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":25},"generated":{"line":72,"column":64}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":66},"generated":{"line":72,"column":66}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":71},"generated":{"line":72,"column":71}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":25},"generated":{"line":72,"column":74}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":87,"column":6},"generated":{"line":72,"column":75}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":6},"generated":{"line":73,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":12},"generated":{"line":73,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":17},"generated":{"line":73,"column":17}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":20},"generated":{"line":73,"column":20}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":25},"generated":{"line":73,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":26},"generated":{"line":73,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":20},"generated":{"line":73,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":32},"generated":{"line":73,"column":31}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":20},"generated":{"line":73,"column":34}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":36},"generated":{"line":73,"column":35}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":42},"generated":{"line":73,"column":41}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":36},"generated":{"line":73,"column":45}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":49},"generated":{"line":73,"column":49}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":8},"generated":{"line":74,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":14},"generated":{"line":74,"column":14}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":18},"generated":{"line":74,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":21},"generated":{"line":74,"column":21}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":27},"generated":{"line":74,"column":27}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":32},"generated":{"line":74,"column":32}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":27},"generated":{"line":74,"column":40}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":41},"generated":{"line":74,"column":41}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":27},"generated":{"line":74,"column":44}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":57},"generated":{"line":74,"column":45}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":57},"generated":{"line":74,"column":56}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":57},"generated":{"line":74,"column":57}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":27},"generated":{"line":74,"column":66}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":68},"generated":{"line":74,"column":68}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":27},"generated":{"line":74,"column":72}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":89,"column":8},"generated":{"line":74,"column":73}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":8},"generated":{"line":75,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":12},"generated":{"line":75,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":13},"generated":{"line":75,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":8},"generated":{"line":75,"column":17}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":19},"generated":{"line":75,"column":19}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":25},"generated":{"line":75,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":29},"generated":{"line":75,"column":29}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":29},"generated":{"line":75,"column":37}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":29},"generated":{"line":75,"column":38}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":25},"generated":{"line":75,"column":50}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":42},"generated":{"line":75,"column":51}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":47},"generated":{"line":75,"column":56}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":25},"generated":{"line":75,"column":59}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":52},"generated":{"line":75,"column":61}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":25},"generated":{"line":75,"column":65}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":90,"column":19},"generated":{"line":75,"column":66}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":91,"column":8},"generated":{"line":76,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":91,"column":15},"generated":{"line":76,"column":15}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":91,"column":19},"generated":{"line":76,"column":19}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":91,"column":20},"generated":{"line":76,"column":20}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":91,"column":8},"generated":{"line":76,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":92,"column":7},"generated":{"line":77,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":20},"generated":{"line":77,"column":7}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":88,"column":6},"generated":{"line":77,"column":8}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":6},"generated":{"line":78,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":11},"generated":{"line":78,"column":11}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":6},"generated":{"line":78,"column":15}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":18},"generated":{"line":78,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":22},"generated":{"line":78,"column":22}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":18},"generated":{"line":78,"column":26}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":27},"generated":{"line":78,"column":28}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":33},"generated":{"line":78,"column":34}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":40},"generated":{"line":78,"column":41}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":41},"generated":{"line":78,"column":42}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":33},"generated":{"line":78,"column":45}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":45},"generated":{"line":78,"column":46}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":33},"generated":{"line":78,"column":51}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":18},"generated":{"line":78,"column":52}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":93,"column":6},"generated":{"line":78,"column":54}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":94,"column":6},"generated":{"line":79,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":94,"column":13},"generated":{"line":79,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":94,"column":18},"generated":{"line":79,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":94,"column":13},"generated":{"line":79,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":94,"column":26},"generated":{"line":79,"column":26}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":94,"column":13},"generated":{"line":79,"column":32}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":94,"column":6},"generated":{"line":79,"column":34}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":95,"column":5},"generated":{"line":80,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":11},"generated":{"line":80,"column":5}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":83,"column":4},"generated":{"line":80,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":96,"column":3},"generated":{"line":81,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":98,"column":2},"generated":{"line":82,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":99,"column":9},"generated":{"line":85,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":99,"column":9},"generated":{"line":85,"column":2}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":99,"column":13},"generated":{"line":85,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":99,"column":13},"generated":{"line":85,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":100,"column":4},"generated":{"line":86,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":100,"column":11},"generated":{"line":86,"column":11}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":100,"column":16},"generated":{"line":86,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":100,"column":11},"generated":{"line":86,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":100,"column":24},"generated":{"line":86,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":100,"column":35},"generated":{"line":86,"column":36}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":101,"column":6},"generated":{"line":87,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":101,"column":10},"generated":{"line":87,"column":10}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":101,"column":15},"generated":{"line":87,"column":15}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":101,"column":18},"generated":{"line":87,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":101,"column":23},"generated":{"line":87,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":101,"column":6},"generated":{"line":87,"column":29}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":102,"column":6},"generated":{"line":88,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":102,"column":10},"generated":{"line":88,"column":10}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":102,"column":13},"generated":{"line":88,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":102,"column":16},"generated":{"line":88,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":102,"column":21},"generated":{"line":88,"column":21}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":102,"column":24},"generated":{"line":88,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":102,"column":29},"generated":{"line":88,"column":29}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":102,"column":6},"generated":{"line":88,"column":38}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":103,"column":6},"generated":{"line":90,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":103,"column":10},"generated":{"line":90,"column":10}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":103,"column":15},"generated":{"line":90,"column":15}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":103,"column":19},"generated":{"line":90,"column":19}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":103,"column":24},"generated":{"line":90,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":103,"column":6},"generated":{"line":90,"column":27}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":103,"column":29},"generated":{"line":90,"column":29}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":104,"column":8},"generated":{"line":91,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":104,"column":8},"generated":{"line":91,"column":8}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":104,"column":13},"generated":{"line":91,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":104,"column":16},"generated":{"line":91,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":104,"column":21},"generated":{"line":91,"column":21}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":104,"column":8},"generated":{"line":91,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":105,"column":7},"generated":{"line":92,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":106,"column":6},"generated":{"line":94,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":106,"column":10},"generated":{"line":94,"column":10}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":106,"column":13},"generated":{"line":94,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":106,"column":17},"generated":{"line":94,"column":17}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":106,"column":22},"generated":{"line":94,"column":22}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":106,"column":6},"generated":{"line":94,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":106,"column":27},"generated":{"line":94,"column":27}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":107,"column":8},"generated":{"line":95,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":107,"column":8},"generated":{"line":95,"column":8}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":107,"column":11},"generated":{"line":95,"column":11}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":107,"column":14},"generated":{"line":95,"column":14}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":107,"column":19},"generated":{"line":95,"column":19}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":107,"column":8},"generated":{"line":95,"column":22}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":108,"column":7},"generated":{"line":96,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":6},"generated":{"line":98,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":12},"generated":{"line":98,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":18},"generated":{"line":98,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":21},"generated":{"line":98,"column":21}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":27},"generated":{"line":98,"column":27}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":32},"generated":{"line":98,"column":32}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":27},"generated":{"line":98,"column":42}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":43},"generated":{"line":98,"column":43}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":27},"generated":{"line":98,"column":48}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":50},"generated":{"line":98,"column":50}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":27},"generated":{"line":98,"column":53}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":109,"column":6},"generated":{"line":98,"column":54}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":110,"column":6},"generated":{"line":99,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":110,"column":11},"generated":{"line":99,"column":11}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":110,"column":6},"generated":{"line":99,"column":17}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":110,"column":21},"generated":{"line":99,"column":21}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":110,"column":26},"generated":{"line":99,"column":26}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":110,"column":6},"generated":{"line":99,"column":35}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":111,"column":6},"generated":{"line":100,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":111,"column":13},"generated":{"line":100,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":111,"column":6},"generated":{"line":100,"column":19}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":112,"column":5},"generated":{"line":101,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":100,"column":11},"generated":{"line":101,"column":5}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":100,"column":4},"generated":{"line":101,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":113,"column":3},"generated":{"line":102,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":115,"column":10},"generated":{"line":104,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":115,"column":10},"generated":{"line":104,"column":2}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":115,"column":20},"generated":{"line":104,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":115,"column":21},"generated":{"line":104,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":115,"column":20},"generated":{"line":104,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":115,"column":36},"generated":{"line":104,"column":20}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":115,"column":20},"generated":{"line":104,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":115,"column":47},"generated":{"line":104,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":4},"generated":{"line":105,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":11},"generated":{"line":105,"column":11}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":15},"generated":{"line":105,"column":15}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":11},"generated":{"line":105,"column":22}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":31},"generated":{"line":105,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":32},"generated":{"line":105,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":31},"generated":{"line":105,"column":31}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":41},"generated":{"line":105,"column":33}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":31},"generated":{"line":105,"column":39}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":51},"generated":{"line":105,"column":44}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":117,"column":6},"generated":{"line":106,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":117,"column":12},"generated":{"line":106,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":117,"column":18},"generated":{"line":106,"column":18}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":117,"column":21},"generated":{"line":106,"column":21}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":117,"column":25},"generated":{"line":106,"column":25}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":117,"column":21},"generated":{"line":106,"column":35}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":117,"column":6},"generated":{"line":106,"column":37}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":6},"generated":{"line":107,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":6},"generated":{"line":107,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":12},"generated":{"line":107,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":13},"generated":{"line":107,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":6},"generated":{"line":107,"column":29}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":30},"generated":{"line":107,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":6},"generated":{"line":107,"column":40}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":43},"generated":{"line":107,"column":42}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":42},"generated":{"line":107,"column":47}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":57},"generated":{"line":107,"column":51}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":60},"generated":{"line":107,"column":52}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":118,"column":6},"generated":{"line":107,"column":53}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":6},"generated":{"line":108,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":6},"generated":{"line":108,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":12},"generated":{"line":108,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":13},"generated":{"line":108,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":6},"generated":{"line":108,"column":29}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":30},"generated":{"line":108,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":6},"generated":{"line":108,"column":39}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":42},"generated":{"line":108,"column":41}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":41},"generated":{"line":108,"column":46}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":8},"generated":{"line":108,"column":50}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":15},"generated":{"line":108,"column":57}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":16},"generated":{"line":108,"column":58}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":16},"generated":{"line":108,"column":65}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":16},"generated":{"line":108,"column":66}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":16},"generated":{"line":108,"column":72}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":23},"generated":{"line":108,"column":73}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":16},"generated":{"line":108,"column":77}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":28},"generated":{"line":108,"column":78}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":33},"generated":{"line":108,"column":83}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":34},"generated":{"line":108,"column":84}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":28},"generated":{"line":108,"column":90}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":41},"generated":{"line":108,"column":91}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":16},"generated":{"line":108,"column":97}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":120,"column":15},"generated":{"line":108,"column":98}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":119,"column":6},"generated":{"line":108,"column":99}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":6},"generated":{"line":109,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":6},"generated":{"line":109,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":12},"generated":{"line":109,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":13},"generated":{"line":109,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":6},"generated":{"line":109,"column":29}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":30},"generated":{"line":109,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":6},"generated":{"line":109,"column":37}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":40},"generated":{"line":109,"column":39}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":39},"generated":{"line":109,"column":44}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":55},"generated":{"line":109,"column":48}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":61},"generated":{"line":109,"column":54}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":62},"generated":{"line":109,"column":55}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":61},"generated":{"line":109,"column":60}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":122,"column":6},"generated":{"line":109,"column":61}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":6},"generated":{"line":110,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":6},"generated":{"line":110,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":12},"generated":{"line":110,"column":12}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":13},"generated":{"line":110,"column":13}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":6},"generated":{"line":110,"column":30}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":31},"generated":{"line":110,"column":31}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":36},"generated":{"line":110,"column":36}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":31},"generated":{"line":110,"column":40}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":41},"generated":{"line":110,"column":41}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":31},"generated":{"line":110,"column":46}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":47},"generated":{"line":110,"column":47}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":31},"generated":{"line":110,"column":52}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":54},"generated":{"line":110,"column":54}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":31},"generated":{"line":110,"column":57}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":123,"column":6},"generated":{"line":110,"column":58}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":124,"column":5},"generated":{"line":111,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":11},"generated":{"line":111,"column":5}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":116,"column":4},"generated":{"line":111,"column":6}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":125,"column":3},"generated":{"line":112,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":127,"column":10},"generated":{"line":114,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":127,"column":10},"generated":{"line":114,"column":2}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":127,"column":17},"generated":{"line":114,"column":9}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":127,"column":27},"generated":{"line":114,"column":10}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":127,"column":17},"generated":{"line":114,"column":14}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":127,"column":57},"generated":{"line":114,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":4},"generated":{"line":115,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":11},"generated":{"line":115,"column":11}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":16},"generated":{"line":115,"column":16}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":11},"generated":{"line":115,"column":23}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":24},"generated":{"line":115,"column":24}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":11},"generated":{"line":115,"column":27}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":28},"generated":{"line":115,"column":28}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":34},"generated":{"line":115,"column":34}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":38},"generated":{"line":115,"column":38}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":11},"generated":{"line":115,"column":40}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":128,"column":4},"generated":{"line":115,"column":41}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":129,"column":3},"generated":{"line":116,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":19},"generated":{"line":118,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":0},"generated":{"line":120,"column":0}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":0},"generated":{"line":120,"column":7}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":0},"generated":{"line":120,"column":8}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":0},"generated":{"line":120,"column":14}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":0},"generated":{"line":120,"column":17}},{"source":"../smoke-node/bucket/reader.ts","name":null,"original":{"line":56,"column":0},"generated":{"line":120,"column":23}}],"sources":{"../smoke-node/bucket/reader.ts":"/*--------------------------------------------------------------------------\r\n\r\nsmoke-node\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2020 Haydn Paterson (sinclair) <haydn.developer@gmail.com>\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n\r\n---------------------------------------------------------------------------*/\r\n\r\nimport { Semaphore, Barrier }              from '../async/index'\r\nimport { Buffer }                          from '../buffer/index'\r\nimport { Database }                        from '../database/index'\r\nimport { FileNotFoundError, BlobNotFound } from './errors'\r\nimport { FileStore, BlobStore }            from './constants'\r\nimport { FileRecord, BlobRecord }          from './records'\r\n\r\nexport interface ReaderOptions {\r\n  /** The IDB Database instance */\r\n  database: Database\r\n  /** A semaphore to schedule operations. */\r\n  semaphore: Semaphore\r\n  /** the location to be reading */\r\n  start?: number\r\n  /** the location to end reading */\r\n  end?: number\r\n  /** The file key. */\r\n  key: string\r\n}\r\n\r\n/**\r\n * Reader\r\n *\r\n * Internal reader type. Used to read buffer streams from IDB storage. This type\r\n * is used by the buckets readable() method to construct a Readable<Buffer> type\r\n * for streaming files.\r\n */\r\nexport class Reader {\r\n  private database: Database\r\n  private semaphore: Semaphore\r\n  private key: string\r\n\r\n  private barrier: Barrier\r\n  private blob: Blob\r\n  private chunkSize: number\r\n  private offset: number\r\n  private start: number\r\n  private end: number\r\n\r\n  /** Creates a new reader with the given options. */\r\n  constructor(options: ReaderOptions) {\r\n    this.database = options.database\r\n    this.semaphore = options.semaphore\r\n    this.key = options.key\r\n    this.barrier = new Barrier()\r\n    this.blob = new Blob([])\r\n    this.chunkSize = 65536\r\n    this.start = options.start || 0\r\n    this.end = options.end || Infinity\r\n    this.offset = this.start\r\n  }\r\n\r\n  /** Prepares this reader for reading. */\r\n  public async prepare() {\r\n    return this.semaphore.run(async () => {\r\n      if (!(await this.database.exists(FileStore, this.key))) {\r\n        throw new FileNotFoundError(this.key)\r\n      }\r\n      const file = await this.database.get<FileRecord>(FileStore, this.key)\r\n      const blobs = file!.blobs.map(async link => {\r\n        const blob = await this.database.get<BlobRecord>(BlobStore, link)\r\n        if (!blob) throw new BlobNotFound(this.key, link)\r\n        return blob.blob\r\n      })\r\n      this.blob = new Blob(await Promise.all(blobs))\r\n      return this.barrier.resume()\r\n    })\r\n  }\r\n\r\n  /** Reads bytes from the underlying source. */\r\n  public read(): Promise<Buffer> {\r\n    return this.execute(async () => {\r\n      let start = this.offset\r\n      let end = start + this.chunkSize\r\n      if (start >= this.end) {\r\n        start = this.end\r\n      }\r\n      if (end >= this.end) {\r\n        end = this.end\r\n      }\r\n      const buffer = await this.readBuffer(start, end)\r\n      this.offset += this.chunkSize\r\n      return buffer\r\n    })\r\n  }\r\n\r\n  private readBuffer(start: number, end: number): Promise<Buffer> {\r\n    return new Promise<Buffer>((resolve, reject) => {\r\n      const reader = new FileReader()\r\n      reader.addEventListener('progress', (event: any) => {})\r\n      reader.addEventListener('loadend', (event: any) =>\r\n        resolve(Buffer.from(event.target.result))\r\n      )\r\n      reader.addEventListener('error', (event: any) => reject(event))\r\n      reader.readAsArrayBuffer(this.blob.slice(start, end))\r\n    })\r\n  }\r\n\r\n  private execute<T = any>(func: () => PromiseLike<T> | T) {\r\n    return this.barrier.run(() => func())\r\n  }\r\n}\r\n"},"lineCount":null}},"error":null,"hash":"158230d730facd04bf6e91b5580c4dad","cacheData":{"env":{}}}