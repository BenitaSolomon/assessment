{"id":"../smoke-node/rest/server/server.ts","dependencies":[{"name":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\tsconfig.json","includedInParent":true,"mtime":1582445133494},{"name":"C:\\Users\\Administrator\\Desktop\\smoke\\package.json","includedInParent":true,"mtime":1582444621053},{"name":"../../sockets/index","loc":{"line":30,"column":24},"parent":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\rest\\server\\server.ts","resolved":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\sockets\\index.ts"},{"name":"../protocol/index","loc":{"line":31,"column":24},"parent":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\rest\\server\\server.ts","resolved":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\rest\\protocol\\index.ts"},{"name":"./request","loc":{"line":32,"column":26},"parent":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\rest\\server\\server.ts","resolved":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\rest\\server\\request.ts"},{"name":"./response","loc":{"line":33,"column":27},"parent":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\rest\\server\\server.ts","resolved":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\rest\\server\\response.ts"},{"name":"./router","loc":{"line":34,"column":25},"parent":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\rest\\server\\server.ts","resolved":"C:\\Users\\Administrator\\Desktop\\smoke\\smoke-node\\rest\\server\\router.ts"}],"generated":{"js":"\"use strict\";\n/*--------------------------------------------------------------------------\r\n\r\nsmoke-node\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2020 Haydn Paterson (sinclair) <haydn.developer@gmail.com>\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n\r\n---------------------------------------------------------------------------*/\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst index_1 = require(\"../../sockets/index\");\n\nconst index_2 = require(\"../protocol/index\");\n\nconst request_1 = require(\"./request\");\n\nconst response_1 = require(\"./response\");\n\nconst router_1 = require(\"./router\");\n\nconst NETWORK_TIMEOUT = 4000;\n/**\r\n * A Rest server implementation fashioned on the nodejs express module.\r\n * This server provides route matching, middleware, and router and allows\r\n * for the transmission of byte data as well as MediaStream sharing using\r\n * response response semantics.\r\n */\n\nclass RestServer extends router_1.Router {\n  /** Creates a new instance of this server */\n  constructor(sockets, options) {\n    super();\n    this.sockets = sockets;\n    this.options = options;\n    this.options = this.options || {};\n    this.options.timeout = this.options.timeout || NETWORK_TIMEOUT;\n  }\n  /** Starts this server listening on the given port. */\n\n\n  listen(port) {\n    this.server = this.sockets.createServer(socket => this.onSocket(socket));\n    this.server.listen(port);\n    return this;\n  }\n  /** Disposes of this server. */\n\n\n  dispose() {\n    this.server.dispose();\n  }\n  /** Handles this socket as a request / response. */\n\n\n  async onSocket(socket) {\n    const stream = new index_1.NetworkStream(socket, this.options.timeout);\n    const response = new response_1.RestResponse(stream);\n\n    try {\n      const header = await index_2.HeaderProtocol.readRequestHeader(stream);\n      const request = new request_1.RestRequest(stream, header);\n      this.handle(request, response, () => {\n        response.text('not found', 404);\n      });\n    } catch (error) {\n      response.text('internal server error', 500);\n    }\n  }\n\n}\n\nexports.RestServer = RestServer;"},"sourceMaps":{"js":{"mappings":[{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":2,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":34,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":34,"column":6}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":34,"column":13}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":34,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":34,"column":23}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":34,"column":24}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":34,"column":45}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":33,"column":0},"generated":{"line":34,"column":46}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":36,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":36,"column":6}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":36,"column":13}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":36,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":36,"column":23}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":36,"column":24}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":36,"column":43}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":34,"column":0},"generated":{"line":36,"column":44}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":38,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":38,"column":6}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":38,"column":15}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":38,"column":18}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":38,"column":25}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":38,"column":26}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":38,"column":37}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":35,"column":0},"generated":{"line":38,"column":38}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":36,"column":0},"generated":{"line":40,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":36,"column":0},"generated":{"line":40,"column":6}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":36,"column":0},"generated":{"line":40,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":36,"column":0},"generated":{"line":40,"column":19}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":36,"column":0},"generated":{"line":40,"column":26}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":36,"column":0},"generated":{"line":40,"column":27}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":36,"column":0},"generated":{"line":40,"column":39}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":36,"column":0},"generated":{"line":40,"column":40}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":37,"column":0},"generated":{"line":42,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":37,"column":0},"generated":{"line":42,"column":6}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":37,"column":0},"generated":{"line":42,"column":14}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":37,"column":0},"generated":{"line":42,"column":17}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":37,"column":0},"generated":{"line":42,"column":24}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":37,"column":0},"generated":{"line":42,"column":25}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":37,"column":0},"generated":{"line":42,"column":35}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":37,"column":0},"generated":{"line":42,"column":36}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":44,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":39,"column":6},"generated":{"line":44,"column":6}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":39,"column":21},"generated":{"line":44,"column":21}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":39,"column":24},"generated":{"line":44,"column":24}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":44,"column":28}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":54,"column":0},"generated":{"line":45,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":52,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":13},"generated":{"line":52,"column":6}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":52,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":32},"generated":{"line":52,"column":25}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":32},"generated":{"line":52,"column":33}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":32},"generated":{"line":52,"column":34}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":52,"column":40}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":38},"generated":{"line":52,"column":41}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":63,"column":2},"generated":{"line":53,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":2},"generated":{"line":54,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":2},"generated":{"line":54,"column":2}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":2},"generated":{"line":54,"column":13}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":31},"generated":{"line":54,"column":14}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":2},"generated":{"line":54,"column":21}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":57},"generated":{"line":54,"column":23}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":2},"generated":{"line":54,"column":30}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":84},"generated":{"line":54,"column":32}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":65,"column":4},"generated":{"line":55,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":31},"generated":{"line":56,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":31},"generated":{"line":56,"column":9}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":31},"generated":{"line":56,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":31},"generated":{"line":56,"column":19}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":31},"generated":{"line":56,"column":26}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":57},"generated":{"line":57,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":57},"generated":{"line":57,"column":9}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":57},"generated":{"line":57,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":57},"generated":{"line":57,"column":19}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":64,"column":57},"generated":{"line":57,"column":26}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":66,"column":4},"generated":{"line":58,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":66,"column":9},"generated":{"line":58,"column":9}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":66,"column":4},"generated":{"line":58,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":66,"column":19},"generated":{"line":58,"column":19}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":66,"column":24},"generated":{"line":58,"column":24}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":66,"column":19},"generated":{"line":58,"column":31}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":66,"column":35},"generated":{"line":58,"column":35}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":66,"column":4},"generated":{"line":58,"column":37}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":4},"generated":{"line":59,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":9},"generated":{"line":59,"column":9}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":4},"generated":{"line":59,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":17},"generated":{"line":59,"column":17}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":4},"generated":{"line":59,"column":24}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":27},"generated":{"line":59,"column":27}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":32},"generated":{"line":59,"column":32}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":27},"generated":{"line":59,"column":39}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":40},"generated":{"line":59,"column":40}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":27},"generated":{"line":59,"column":47}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":51},"generated":{"line":59,"column":51}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":67,"column":4},"generated":{"line":59,"column":66}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":68,"column":3},"generated":{"line":60,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":70,"column":2},"generated":{"line":61,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":71,"column":9},"generated":{"line":64,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":71,"column":9},"generated":{"line":64,"column":2}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":71,"column":15},"generated":{"line":64,"column":8}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":71,"column":16},"generated":{"line":64,"column":9}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":71,"column":15},"generated":{"line":64,"column":13}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":71,"column":37},"generated":{"line":64,"column":15}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":4},"generated":{"line":65,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":9},"generated":{"line":65,"column":9}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":4},"generated":{"line":65,"column":15}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":18},"generated":{"line":65,"column":18}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":23},"generated":{"line":65,"column":23}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":18},"generated":{"line":65,"column":30}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":31},"generated":{"line":65,"column":31}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":18},"generated":{"line":65,"column":43}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":44},"generated":{"line":65,"column":44}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":50},"generated":{"line":65,"column":50}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":54},"generated":{"line":65,"column":54}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":59},"generated":{"line":65,"column":59}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":54},"generated":{"line":65,"column":67}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":68},"generated":{"line":65,"column":68}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":54},"generated":{"line":65,"column":74}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":18},"generated":{"line":65,"column":75}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":72,"column":4},"generated":{"line":65,"column":76}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":73,"column":4},"generated":{"line":66,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":73,"column":9},"generated":{"line":66,"column":9}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":73,"column":4},"generated":{"line":66,"column":15}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":73,"column":16},"generated":{"line":66,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":73,"column":4},"generated":{"line":66,"column":22}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":73,"column":23},"generated":{"line":66,"column":23}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":73,"column":4},"generated":{"line":66,"column":27}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":74,"column":4},"generated":{"line":67,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":74,"column":11},"generated":{"line":67,"column":11}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":74,"column":4},"generated":{"line":67,"column":15}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":75,"column":3},"generated":{"line":68,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":77,"column":2},"generated":{"line":69,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":78,"column":9},"generated":{"line":72,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":78,"column":9},"generated":{"line":72,"column":2}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":78,"column":16},"generated":{"line":72,"column":9}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":78,"column":16},"generated":{"line":72,"column":12}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":79,"column":4},"generated":{"line":73,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":79,"column":9},"generated":{"line":73,"column":9}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":79,"column":4},"generated":{"line":73,"column":15}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":79,"column":16},"generated":{"line":73,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":79,"column":4},"generated":{"line":73,"column":23}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":80,"column":3},"generated":{"line":74,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":82,"column":2},"generated":{"line":75,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":83,"column":10},"generated":{"line":78,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":83,"column":16},"generated":{"line":78,"column":8}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":83,"column":10},"generated":{"line":78,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":83,"column":25},"generated":{"line":78,"column":17}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":83,"column":10},"generated":{"line":78,"column":23}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":83,"column":39},"generated":{"line":78,"column":25}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":4},"generated":{"line":79,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":10},"generated":{"line":79,"column":10}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":16},"generated":{"line":79,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":21},"generated":{"line":79,"column":19}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":25},"generated":{"line":79,"column":23}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":25},"generated":{"line":79,"column":30}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":25},"generated":{"line":79,"column":31}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":21},"generated":{"line":79,"column":44}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":39},"generated":{"line":79,"column":45}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":21},"generated":{"line":79,"column":51}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":47},"generated":{"line":79,"column":53}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":52},"generated":{"line":79,"column":58}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":47},"generated":{"line":79,"column":65}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":61},"generated":{"line":79,"column":66}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":21},"generated":{"line":79,"column":73}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":84,"column":4},"generated":{"line":79,"column":74}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":4},"generated":{"line":80,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":10},"generated":{"line":80,"column":10}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":18},"generated":{"line":80,"column":18}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":21},"generated":{"line":80,"column":21}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":25},"generated":{"line":80,"column":25}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":25},"generated":{"line":80,"column":35}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":25},"generated":{"line":80,"column":36}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":21},"generated":{"line":80,"column":48}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":38},"generated":{"line":80,"column":49}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":21},"generated":{"line":80,"column":55}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":85,"column":4},"generated":{"line":80,"column":56}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":86,"column":4},"generated":{"line":82,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":86,"column":8},"generated":{"line":82,"column":8}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":6},"generated":{"line":83,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":12},"generated":{"line":83,"column":12}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":18},"generated":{"line":83,"column":18}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":21},"generated":{"line":83,"column":21}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":27},"generated":{"line":83,"column":27}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":27},"generated":{"line":83,"column":34}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":27},"generated":{"line":83,"column":35}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":27},"generated":{"line":83,"column":49}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":42},"generated":{"line":83,"column":50}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":27},"generated":{"line":83,"column":67}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":60},"generated":{"line":83,"column":68}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":27},"generated":{"line":83,"column":74}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":87,"column":6},"generated":{"line":83,"column":75}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":6},"generated":{"line":84,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":12},"generated":{"line":84,"column":12}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":19},"generated":{"line":84,"column":19}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":22},"generated":{"line":84,"column":22}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":26},"generated":{"line":84,"column":26}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":26},"generated":{"line":84,"column":35}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":26},"generated":{"line":84,"column":36}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":22},"generated":{"line":84,"column":47}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":38},"generated":{"line":84,"column":48}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":22},"generated":{"line":84,"column":54}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":46},"generated":{"line":84,"column":56}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":22},"generated":{"line":84,"column":62}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":88,"column":6},"generated":{"line":84,"column":63}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":6},"generated":{"line":85,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":11},"generated":{"line":85,"column":11}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":6},"generated":{"line":85,"column":17}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":18},"generated":{"line":85,"column":18}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":6},"generated":{"line":85,"column":25}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":27},"generated":{"line":85,"column":27}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":6},"generated":{"line":85,"column":35}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":37},"generated":{"line":85,"column":37}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":42},"generated":{"line":85,"column":43}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":45},"generated":{"line":86,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":45},"generated":{"line":86,"column":8}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":53},"generated":{"line":86,"column":16}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":54},"generated":{"line":86,"column":17}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":45},"generated":{"line":86,"column":21}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":59},"generated":{"line":86,"column":22}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":45},"generated":{"line":86,"column":33}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":72},"generated":{"line":86,"column":35}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":45},"generated":{"line":86,"column":38}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":78},"generated":{"line":87,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":89,"column":6},"generated":{"line":87,"column":7}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":90,"column":5},"generated":{"line":88,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":86,"column":4},"generated":{"line":88,"column":5}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":90,"column":6},"generated":{"line":88,"column":6}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":90,"column":13},"generated":{"line":88,"column":13}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":90,"column":6},"generated":{"line":88,"column":18}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":90,"column":20},"generated":{"line":88,"column":20}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":91,"column":6},"generated":{"line":89,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":91,"column":6},"generated":{"line":89,"column":6}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":91,"column":14},"generated":{"line":89,"column":14}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":91,"column":15},"generated":{"line":89,"column":15}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":91,"column":6},"generated":{"line":89,"column":19}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":91,"column":20},"generated":{"line":89,"column":20}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":91,"column":6},"generated":{"line":89,"column":43}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":91,"column":45},"generated":{"line":89,"column":45}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":91,"column":6},"generated":{"line":89,"column":48}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":92,"column":5},"generated":{"line":90,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":93,"column":3},"generated":{"line":91,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":38},"generated":{"line":93,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":95,"column":0}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":95,"column":7}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":95,"column":8}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":95,"column":18}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":95,"column":21}},{"source":"../smoke-node/rest/server/server.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":95,"column":31}}],"sources":{"../smoke-node/rest/server/server.ts":"/*--------------------------------------------------------------------------\r\n\r\nsmoke-node\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2020 Haydn Paterson (sinclair) <haydn.developer@gmail.com>\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n\r\n---------------------------------------------------------------------------*/\r\n\r\nimport { Disposable }     from '../../dispose'\r\nimport { Sockets }        from '../../sockets/index'\r\nimport { SocketServer }   from '../../sockets/index'\r\nimport { Socket }         from '../../sockets/index'\r\nimport { NetworkStream }  from '../../sockets/index'\r\nimport { HeaderProtocol } from '../protocol/index'\r\nimport { RestRequest }    from './request'\r\nimport { RestResponse }   from './response'\r\nimport { Router }         from './router'\r\n\r\nconst NETWORK_TIMEOUT = 4000\r\n\r\nexport interface RestServerOptions {\r\n  /**\r\n   * Sets the network protocol read write timeout for this REST server in\r\n   * milliseconds. The default is 4 seconds. Internally, REST servers use a\r\n   * pull based network protocol that only transmits data if the remote peer\r\n   * asks for it. This setting relates to an inactivity threshold used by the\r\n   * underlying protocol and not the request itself. Request / Responses can\r\n   * last as long as they need to so long as data is constantly flowing\r\n   * over the socket.\r\n   */\r\n  timeout?: number\r\n}\r\n\r\n/**\r\n * A Rest server implementation fashioned on the nodejs express module.\r\n * This server provides route matching, middleware, and router and allows\r\n * for the transmission of byte data as well as MediaStream sharing using\r\n * response response semantics.\r\n */\r\nexport class RestServer extends Router implements Disposable {\r\n  private server!: SocketServer\r\n\r\n  /** Creates a new instance of this server */\r\n  constructor(private readonly sockets: Sockets, private options?: RestServerOptions) {\r\n    super()\r\n    this.options = this.options || {}\r\n    this.options.timeout = this.options.timeout || NETWORK_TIMEOUT\r\n  }\r\n\r\n  /** Starts this server listening on the given port. */\r\n  public listen(port: number | string): RestServer {\r\n    this.server = this.sockets.createServer(socket => this.onSocket(socket))\r\n    this.server.listen(port)\r\n    return this\r\n  }\r\n\r\n  /** Disposes of this server. */\r\n  public dispose() {\r\n    this.server.dispose()\r\n  }\r\n\r\n  /** Handles this socket as a request / response. */\r\n  private async onSocket(socket: Socket) {\r\n    const stream   = new NetworkStream(socket, this.options!.timeout)\r\n    const response = new RestResponse(stream)\r\n    try {\r\n      const header = await HeaderProtocol.readRequestHeader(stream)\r\n      const request = new RestRequest(stream, header)\r\n      this.handle(request, response, () => { response.text('not found', 404) })\r\n    } catch (error) {\r\n      response.text('internal server error', 500)\r\n    }\r\n  }\r\n}\r\n"},"lineCount":null}},"error":null,"hash":"bc06c9c9b8cb3e503bec1082f0428092","cacheData":{"env":{}}}